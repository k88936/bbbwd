# 物理
物理引擎：box2d  
简单总结：
1. body是一个整体，可以由多个shape组成
2. shape描述了一个body的一部分的形状和密度等等物理特性，  
有趣的是虽然名为shape，但是shapedef不包含对形状的定义，另外需要geometry
## design
###  零件
零件一般只有一个body，特殊的比如电锯有基座和圆形转盘两个body，一个马达关节

###  连接点
连接点本质是添加一个零自由度的关节，把两个零件（的body）固定，用来实现整体和破碎的效果，也方便后续的运输，热量传递等等.


## implementation
### 关于Java对box2d的调用
本质是利用gdx的jnigen生成jni调用box2d v3暴露的方法。但是gdx现在的官方绑定（估计v2时代也是）jni调用进行了大量
没必要的对象生成，而且返回的是根据box2d的向量，矩阵生成的特殊的对象，还要手动转换为gdx的对象，这样的效率很低。
我自己分支出一个版本，尽量使用原始类型做参数，返回值，减少对象生成，提高效率。(参考discord上的讨论)   
还有几个别扭的地方，box2d很多的操作单位是shape。我本来的设计希望是body。（比如aabb查询）  
关于用户数据：官方绑定里给了给void类型指针但是不能读写。给我的答复是用地址hash到java对象 
callback函数调用方面太多新建对象了。  

### 最佳实践
* 采用共享内存的方式，传递向量，矩阵数据，减少对象生成。实际上是只传地址的，不传对象。（bytebuffer之类）
* 函数回调方面，要么自己用c语言包装一层，给闭包只传递原始类型，要么让作者考虑提供一个每个闭包不变的内存缓存，我认为性能瓶颈就在不断的malloc和new上
<!-- 特性： -->  
<!-- * [x] 传递向量，矩阵数据优化 -->
<!-- * [x] 用户数据读写 -->
<!-- * [ ] callback 函数优化 -->
<!-- * [ ] 批量化 -->


